<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : Zhed
Description : Solver for Zhed
Copyright   : (c) Eric Mertens, 2018
License     : ISC
Maintainer  : emertens@gmail.com

This module implements a solver for the Zhed game.

In Zhed the player is presented with a grid of cells that can be either
marked or unmarked. Additionally one or more cells will be designated
as the target cell. In the initial puzzle state each of the pre-marked
cells will have a number on it. Each of these numbered cells can be activated
exactly once. When activated a cardinal direction is chosen. The number
indicates how many of the nearest, unmarked cells will become marked.

The puzzle is considered solved when a target cell is marked.

https://play.google.com/store/apps/details?id=com.groundcontrol.zhed&amp;hl=en_US

For more puzzle files, see https://github.com/glguy/5puzzle/tree/master/zhed-puzzles

-}</span><span>
</span><a name="line-24"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Zhed</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-comment">-- base</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Prelude.html"><span class="hs-identifier">Prelude</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a><span>      </span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Control.Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Char.html"><span class="hs-identifier">Data.Char</span></a><span>          </span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Char.html#digitToInt"><span class="hs-identifier hs-var">digitToInt</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Unicode.html#isDigit"><span class="hs-identifier hs-var">isDigit</span></a><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a><span>      </span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a><span> </span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a><span class="hs-special">(</span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#%3A%7C"><span class="hs-operator hs-var">:|</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-comment">-- sat-for-games</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><a href="Ersatz.Prelude.html"><span class="hs-identifier">Ersatz.Prelude</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><a href="Count.html"><span class="hs-identifier">Count</span></a><span>    </span><span class="hs-special">(</span><a href="Count.html#Count"><span class="hs-identifier hs-type">Count</span></a><span class="hs-special">,</span><span> </span><a href="Count.html#addBit"><span class="hs-identifier hs-var">addBit</span></a><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><a href="Select.html"><span class="hs-identifier">Select</span></a><span>   </span><span class="hs-special">(</span><a href="Select.html#Select"><span class="hs-identifier hs-type">Select</span></a><span class="hs-special">,</span><span> </span><a href="Select.html#runSelect"><span class="hs-identifier hs-var">runSelect</span></a><span class="hs-special">,</span><span> </span><a href="Select.html#selectPermutationN"><span class="hs-identifier hs-var">selectPermutationN</span></a><span class="hs-special">,</span><span> </span><a href="Select.html#selectList"><span class="hs-identifier hs-var">selectList</span></a><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><a href="TotalMap.html"><span class="hs-identifier">TotalMap</span></a><span> </span><span class="hs-special">(</span><a href="TotalMap.html#TotalMap"><span class="hs-identifier hs-type">TotalMap</span></a><span class="hs-special">,</span><span> </span><a href="TotalMap.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TotalMap.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-comment">-- | Grid coordinate</span><span>
</span><a name="line-40"></a><span class="hs-keyword">data</span><span> </span><a name="Coord"><a href="Zhed.html#Coord"><span class="hs-identifier">Coord</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="C"><a href="Zhed.html#C"><span class="hs-identifier">C</span></a></a><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span> </span><span class="hs-comment">-- ^ column row</span><span>
</span><a name="line-41"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Read.html#Read"><span class="hs-identifier hs-type">Read</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">-- | Cardinal directions: up, down, left, right</span><span>
</span><a name="line-44"></a><span class="hs-keyword">data</span><span> </span><a name="Dir"><a href="Zhed.html#Dir"><span class="hs-identifier">Dir</span></a></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="U"><a href="Zhed.html#U"><span class="hs-identifier">U</span></a></a><span> </span><span class="hs-comment">-- ^ up</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="D"><a href="Zhed.html#D"><span class="hs-identifier">D</span></a></a><span> </span><span class="hs-comment">-- ^ down</span><span>
</span><a name="line-47"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="L"><a href="Zhed.html#L"><span class="hs-identifier">L</span></a></a><span> </span><span class="hs-comment">-- ^ left</span><span>
</span><a name="line-48"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="R"><a href="Zhed.html#R"><span class="hs-identifier">R</span></a></a><span> </span><span class="hs-comment">-- ^ right</span><span>
</span><a name="line-49"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Read.html#Read"><span class="hs-identifier hs-type">Read</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">-- | Board dimensions</span><span>
</span><a name="line-52"></a><span class="hs-keyword">data</span><span> </span><a name="Dim"><a href="Zhed.html#Dim"><span class="hs-identifier">Dim</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Dim"><a href="Zhed.html#Dim"><span class="hs-identifier">Dim</span></a></a><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span> </span><span class="hs-comment">-- ^ width height</span><span>
</span><a name="line-53"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Read.html#Read"><span class="hs-identifier hs-type">Read</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">-- | Puzzle parameters: board dimensions, numbered cells, target cells</span><span>
</span><a name="line-58"></a><span class="hs-keyword">data</span><span> </span><a name="Puzzle"><a href="Zhed.html#Puzzle"><span class="hs-identifier">Puzzle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Puzzle"><a href="Zhed.html#Puzzle"><span class="hs-identifier">Puzzle</span></a></a><span> </span><a href="Zhed.html#Dim"><span class="hs-identifier hs-type">Dim</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span class="hs-special">,</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span class="hs-special">]</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Read.html#Read"><span class="hs-identifier hs-type">Read</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Classes.html#Ord"><span class="hs-identifier hs-type">Ord</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- | An 8-by-8 puzzle</span><span>
</span><a name="line-62"></a><span class="hs-identifier">largeZhed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Zhed.html#Puzzle"><span class="hs-identifier hs-type">Puzzle</span></a><span>
</span><a name="line-63"></a><a name="largeZhed"><a href="Zhed.html#largeZhed"><span class="hs-identifier">largeZhed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Zhed.html#parsePuzzle"><span class="hs-identifier hs-var">parsePuzzle</span></a><span>
</span><a name="line-64"></a><span>  </span><span class="hs-string">&quot;..2.....\n\
  \.......4\n\
  \2.....1.\n\
  \...1....\n\
  \....X...\n\
  \4.......\n\
  \3.......\n\
  \....1...\n&quot;</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- | A 3-by-3 puzzle</span><span>
</span><a name="line-74"></a><span class="hs-identifier">smallZhed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Zhed.html#Puzzle"><span class="hs-identifier hs-type">Puzzle</span></a><span>
</span><a name="line-75"></a><a name="smallZhed"><a href="Zhed.html#smallZhed"><span class="hs-identifier">smallZhed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Zhed.html#parsePuzzle"><span class="hs-identifier hs-var">parsePuzzle</span></a><span>
</span><a name="line-76"></a><span>  </span><span class="hs-string">&quot;..1\n\
  \2..\n\
  \..X\n&quot;</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">-- | Construct a mapping from coordinates to bits suitable for use as a</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- symbolic set.</span><span>
</span><a name="line-84"></a><span class="hs-identifier">cellsFromList</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-85"></a><span>  </span><span class="hs-special">[</span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span class="hs-special">]</span><span>            </span><span class="hs-comment">{- ^ coordinate list                 -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-86"></a><span>  </span><a href="TotalMap.html#TotalMap"><span class="hs-identifier hs-type">TotalMap</span></a><span> </span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span> </span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Bit.html#Bit"><span class="hs-identifier hs-type">Bit</span></a><span> </span><span class="hs-comment">{- ^ map listed coordinates set true -}</span><span>
</span><a name="line-87"></a><a name="cellsFromList"><a href="Zhed.html#cellsFromList"><span class="hs-identifier">cellsFromList</span></a></a><span> </span><a name="local-6989586621679115768"><a href="#local-6989586621679115768"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TotalMap.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span> </span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Bit.html#false"><span class="hs-identifier hs-var">false</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679115769"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Bit.html#true"><span class="hs-identifier hs-var">true</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679115769"><a href="#local-6989586621679115769"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679115768"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">]</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-comment">-- | Produce a list of coordinates generated starting at a given</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- location, traveling in a given direction, until the edge of</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- the board is reached. The starting location is not included.</span><span>
</span><a name="line-93"></a><span class="hs-comment">--</span><span>
</span><a name="line-94"></a><span class="hs-comment">-- Valid locations are considered to be from @1@ to the height</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- or width.</span><span>
</span><a name="line-96"></a><span class="hs-comment">--</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- Examples</span><span>
</span><a name="line-98"></a><span class="hs-comment">--</span><span>
</span><a name="line-99"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- ....</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- ....</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- .S..</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-104"></a><span class="hs-comment">--</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- &gt;&gt;&gt; let dim = Dim 4 3; s = C 2 3</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- &gt;&gt;&gt; coordsList dim s U</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- [C 2 2,C 2 1]</span><span>
</span><a name="line-108"></a><span class="hs-comment">-- &gt;&gt;&gt; coordsList dim s D</span><span>
</span><a name="line-109"></a><span class="hs-comment">-- []</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- &gt;&gt;&gt; coordsList dim s L</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- [C 1 3]</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- &gt;&gt;&gt; coordsList dim s R</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- [C 3 3,C 4 3]</span><span>
</span><a name="line-114"></a><span class="hs-identifier">coordsList</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-115"></a><span>  </span><a href="Zhed.html#Dim"><span class="hs-identifier hs-type">Dim</span></a><span>     </span><span class="hs-comment">{- ^ board dimensions                      -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-116"></a><span>  </span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span>   </span><span class="hs-comment">{- ^ starting coordinate                   -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-117"></a><span>  </span><a href="Zhed.html#Dir"><span class="hs-identifier hs-type">Dir</span></a><span>     </span><span class="hs-comment">{- ^ direction                             -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-118"></a><span>  </span><span class="hs-special">[</span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">{- ^ list of coordinates in that direction -}</span><span>
</span><a name="line-119"></a><a name="coordsList"><a href="Zhed.html#coordsList"><span class="hs-identifier">coordsList</span></a></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#Dim"><span class="hs-identifier hs-var">Dim</span></a><span> </span><a name="local-6989586621679115770"><a href="#local-6989586621679115770"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679115771"><a href="#local-6989586621679115771"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Zhed.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><a name="local-6989586621679115772"><a href="#local-6989586621679115772"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679115773"><a href="#local-6989586621679115773"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679115774"><a href="#local-6989586621679115774"><span class="hs-identifier">dir</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-120"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679115774"><span class="hs-identifier hs-var">dir</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-121"></a><span>    </span><a href="Zhed.html#U"><span class="hs-identifier hs-var">U</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><a href="Zhed.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><a href="#local-6989586621679115772"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679115775"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679115775"><a href="#local-6989586621679115775"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679115773"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115773"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><span class="hs-number">2</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-122"></a><span>    </span><a href="Zhed.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><a href="Zhed.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><a href="#local-6989586621679115776"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679115773"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679115776"><a href="#local-6989586621679115776"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679115772"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115772"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><span class="hs-number">2</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-123"></a><span>    </span><a href="Zhed.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><a href="Zhed.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><a href="#local-6989586621679115772"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679115777"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679115777"><a href="#local-6989586621679115777"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679115773"><span class="hs-identifier hs-var">y</span></a><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115773"><span class="hs-identifier hs-var">y</span></a><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">2</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679115771"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-124"></a><span>    </span><a href="Zhed.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><a href="Zhed.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><a href="#local-6989586621679115778"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679115773"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679115778"><a href="#local-6989586621679115778"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679115772"><span class="hs-identifier hs-var">x</span></a><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115772"><span class="hs-identifier hs-var">x</span></a><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">2</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679115770"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- | Given a board's dimensions and the map of cells, update</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- the cell map with a symbolically chosen square activation.</span><span>
</span><a name="line-129"></a><span class="hs-identifier">applyMove</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-130"></a><span>  </span><a href="Zhed.html#Dim"><span class="hs-identifier hs-type">Dim</span></a><span>                      </span><span class="hs-comment">{- ^ board dimensions            -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-131"></a><span>  </span><a href="TotalMap.html#TotalMap"><span class="hs-identifier hs-type">TotalMap</span></a><span> </span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span> </span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Bit.html#Bit"><span class="hs-identifier hs-type">Bit</span></a><span>       </span><span class="hs-comment">{- ^ filled cells                -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-132"></a><span>  </span><a href="Select.html#Select"><span class="hs-identifier hs-type">Select</span></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">,</span><span> </span><a href="Zhed.html#Dir"><span class="hs-identifier hs-type">Dir</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">{- ^ chosen square and direction -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-133"></a><span>  </span><a href="TotalMap.html#TotalMap"><span class="hs-identifier hs-type">TotalMap</span></a><span> </span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span> </span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Bit.html#Bit"><span class="hs-identifier hs-type">Bit</span></a><span>       </span><span class="hs-comment">{- ^ updated cells               -}</span><span>
</span><a name="line-134"></a><a name="applyMove"><a href="Zhed.html#applyMove"><span class="hs-identifier">applyMove</span></a></a><span> </span><a name="local-6989586621679115779"><a href="#local-6989586621679115779"><span class="hs-identifier">dim</span></a></a><span> </span><a name="local-6989586621679115780"><a href="#local-6989586621679115780"><span class="hs-identifier">cells</span></a></a><span> </span><a name="local-6989586621679115781"><a href="#local-6989586621679115781"><span class="hs-identifier">move</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-135"></a><span>  </span><a href="Select.html#runSelect"><span class="hs-identifier hs-var">runSelect</span></a><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-comment">-- resolve choice of boards into a single board</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679115782"><a href="#local-6989586621679115782"><span class="hs-identifier">start</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679115783"><a href="#local-6989586621679115783"><span class="hs-identifier">len</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679115784"><a href="#local-6989586621679115784"><span class="hs-identifier">dir</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679115781"><span class="hs-identifier hs-var">move</span></a><span>
</span><a name="line-137"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679115785"><a href="#local-6989586621679115785"><span class="hs-identifier">cells'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span>
</span><a name="line-138"></a><span>                          </span><span class="hs-special">(</span><a href="Zhed.html#spreadCell"><span class="hs-identifier hs-var">spreadCell</span></a><span> </span><a href="#local-6989586621679115783"><span class="hs-identifier hs-var">len</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>                          </span><span class="hs-special">(</span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Codec.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115780"><span class="hs-identifier hs-var">cells</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>                          </span><span class="hs-special">(</span><a href="Zhed.html#coordsList"><span class="hs-identifier hs-var">coordsList</span></a><span> </span><a href="#local-6989586621679115779"><span class="hs-identifier hs-var">dim</span></a><span> </span><a href="#local-6989586621679115782"><span class="hs-identifier hs-var">start</span></a><span> </span><a href="#local-6989586621679115784"><span class="hs-identifier hs-var">dir</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>       </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679115785"><span class="hs-identifier hs-var">cells'</span></a><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-comment">-- | Attempt to mark a particular cell on the given board. Only</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- mark a cell if there the count of cells placed is less than</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- the total number available.</span><span>
</span><a name="line-147"></a><span class="hs-identifier">spreadCell</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-148"></a><span>  </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span>                         </span><span class="hs-comment">{- ^ squares available to place        -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-149"></a><span>  </span><span class="hs-special">(</span><a href="Count.html#Count"><span class="hs-identifier hs-type">Count</span></a><span class="hs-special">,</span><span> </span><a href="TotalMap.html#TotalMap"><span class="hs-identifier hs-type">TotalMap</span></a><span> </span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span> </span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Bit.html#Bit"><span class="hs-identifier hs-type">Bit</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">{- ^ squares placed and current board  -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-150"></a><span>  </span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span>                       </span><span class="hs-comment">{- ^ coordinate to place on            -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-151"></a><span>  </span><span class="hs-special">(</span><a href="Count.html#Count"><span class="hs-identifier hs-type">Count</span></a><span class="hs-special">,</span><span> </span><a href="TotalMap.html#TotalMap"><span class="hs-identifier hs-type">TotalMap</span></a><span> </span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span> </span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Bit.html#Bit"><span class="hs-identifier hs-type">Bit</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">{- ^ updated placement count and board -}</span><span>
</span><a name="line-152"></a><a name="spreadCell"><a href="Zhed.html#spreadCell"><span class="hs-identifier">spreadCell</span></a></a><span> </span><a name="local-6989586621679115786"><a href="#local-6989586621679115786"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679115787"><a href="#local-6989586621679115787"><span class="hs-identifier">used</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679115788"><a href="#local-6989586621679115788"><span class="hs-identifier">cells</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679115789"><a href="#local-6989586621679115789"><span class="hs-identifier">coord</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679115792"><span class="hs-identifier hs-var">updateUsed</span></a><span> </span><a href="#local-6989586621679115787"><span class="hs-identifier hs-var">used</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115793"><span class="hs-identifier hs-var">updateCells</span></a><span> </span><a href="#local-6989586621679115788"><span class="hs-identifier hs-var">cells</span></a><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-154"></a><span>    </span><a name="local-6989586621679115790"><a href="#local-6989586621679115790"><span class="hs-identifier">oldMark</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679115788"><span class="hs-identifier hs-var">cells</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679115789"><span class="hs-identifier hs-var">coord</span></a><span>
</span><a name="line-155"></a><span>    </span><a name="local-6989586621679115791"><a href="#local-6989586621679115791"><span class="hs-identifier">newMark</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679115790"><span class="hs-identifier hs-var">oldMark</span></a><span> </span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Bit.html#%7C%7C"><span class="hs-operator hs-var">||</span></a><span> </span><a href="#local-6989586621679115787"><span class="hs-identifier hs-var">used</span></a><span> </span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Orderable.html#%3C%3F"><span class="hs-operator hs-var">&lt;?</span></a><span> </span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Codec.html#encode"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679115786"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>    </span><a name="local-6989586621679115792"><a href="#local-6989586621679115792"><span class="hs-identifier">updateUsed</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Count.html#addBit"><span class="hs-identifier hs-var">addBit</span></a><span> </span><span class="hs-special">(</span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Bit.html#not"><span class="hs-identifier hs-var">not</span></a><span> </span><a href="#local-6989586621679115790"><span class="hs-identifier hs-var">oldMark</span></a><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>    </span><a name="local-6989586621679115793"><a href="#local-6989586621679115793"><span class="hs-identifier">updateCells</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679115789"><span class="hs-identifier hs-var">coord</span></a><span> </span><a href="TotalMap.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a><span> </span><a href="#local-6989586621679115791"><span class="hs-identifier hs-var">newMark</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-comment">-- | Combine the choice of square to activate with a direction to</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- get back a single choice containing both.</span><span>
</span><a name="line-163"></a><span class="hs-identifier">combineChoices</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Select.html#Select"><span class="hs-identifier hs-type">Select</span></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Select.html#Select"><span class="hs-identifier hs-type">Select</span></a><span> </span><a href="Zhed.html#Dir"><span class="hs-identifier hs-type">Dir</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Select.html#Select"><span class="hs-identifier hs-type">Select</span></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">,</span><span> </span><a href="Zhed.html#Dir"><span class="hs-identifier hs-type">Dir</span></a><span class="hs-special">)</span><span>
</span><a name="line-164"></a><a name="combineChoices"><a href="Zhed.html#combineChoices"><span class="hs-identifier">combineChoices</span></a></a><span> </span><a name="local-6989586621679115794"><a href="#local-6989586621679115794"><span class="hs-identifier">selectSq</span></a></a><span> </span><a name="local-6989586621679115795"><a href="#local-6989586621679115795"><span class="hs-identifier">selectDir</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-165"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679115796"><a href="#local-6989586621679115796"><span class="hs-identifier">coord</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679115797"><a href="#local-6989586621679115797"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679115794"><span class="hs-identifier hs-var">selectSq</span></a><span>
</span><a name="line-166"></a><span>     </span><a name="local-6989586621679115798"><a href="#local-6989586621679115798"><span class="hs-identifier">dir</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679115795"><span class="hs-identifier hs-var">selectDir</span></a><span>
</span><a name="line-167"></a><span>     </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679115796"><span class="hs-identifier hs-var">coord</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115797"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115798"><span class="hs-identifier hs-var">dir</span></a><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">-- | Generate a solution that satisfies the clues in the given puzzle.</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- The solution is represented as an ordered list of the squares to</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- activate and the order to activate them in.</span><span>
</span><a name="line-173"></a><span class="hs-identifier">solutionExists</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-174"></a><span>  </span><a href="Zhed.html#Puzzle"><span class="hs-identifier hs-type">Puzzle</span></a><span>                            </span><span class="hs-comment">{- ^ puzzle parameters -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-175"></a><span>  </span><a href="Ersatz.Prelude.html#Ersatz"><span class="hs-identifier hs-type">Ersatz</span></a><span> </span><span class="hs-special">[</span><a href="Select.html#Select"><span class="hs-identifier hs-type">Select</span></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">,</span><span> </span><a href="Zhed.html#Dir"><span class="hs-identifier hs-type">Dir</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">{- ^ puzzle solution   -}</span><span>
</span><a name="line-176"></a><a name="solutionExists"><a href="Zhed.html#solutionExists"><span class="hs-identifier">solutionExists</span></a></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#Puzzle"><span class="hs-identifier hs-var">Puzzle</span></a><span> </span><a name="local-6989586621679115799"><a href="#local-6989586621679115799"><span class="hs-identifier">dim</span></a></a><span> </span><a name="local-6989586621679115800"><a href="#local-6989586621679115800"><span class="hs-identifier">squares</span></a></a><span> </span><a name="local-6989586621679115801"><a href="#local-6989586621679115801"><span class="hs-identifier">targets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679115802"><a href="#local-6989586621679115802"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679115800"><span class="hs-identifier hs-var">squares</span></a><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span>     </span><span class="hs-comment">-- Choose a permutation of the squares</span><span>
</span><a name="line-181"></a><span>     </span><a name="local-6989586621679115803"><a href="#local-6989586621679115803"><span class="hs-identifier">squares'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Select.html#selectPermutationN"><span class="hs-identifier hs-var">selectPermutationN</span></a><span> </span><a href="#local-6989586621679115802"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679115800"><span class="hs-identifier hs-var">squares</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span>     </span><span class="hs-comment">-- Choose a direction in which to activate each square</span><span>
</span><a name="line-184"></a><span>     </span><a name="local-6989586621679115804"><a href="#local-6989586621679115804"><span class="hs-identifier">dirs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Control.Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a><span> </span><a href="#local-6989586621679115802"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="Select.html#selectList"><span class="hs-identifier hs-var">selectList</span></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#U"><span class="hs-identifier hs-var">U</span></a><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#%3A%7C"><span class="hs-operator hs-var">:|</span></a><span class="hs-special">[</span><a href="Zhed.html#D"><span class="hs-identifier hs-var">D</span></a><span class="hs-special">,</span><a href="Zhed.html#L"><span class="hs-identifier hs-var">L</span></a><span class="hs-special">,</span><a href="Zhed.html#R"><span class="hs-identifier hs-var">R</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span>     </span><span class="hs-comment">-- Combine choosen squares and directions into single choice</span><span>
</span><a name="line-187"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679115805"><a href="#local-6989586621679115805"><span class="hs-identifier">steps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a><span> </span><a href="Zhed.html#combineChoices"><span class="hs-identifier hs-var">combineChoices</span></a><span> </span><a href="#local-6989586621679115803"><span class="hs-identifier hs-var">squares'</span></a><span> </span><a href="#local-6989586621679115804"><span class="hs-identifier hs-var">dirs</span></a><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span>     </span><span class="hs-comment">-- Initially only squares with numbers are marked</span><span>
</span><a name="line-190"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679115806"><a href="#local-6989586621679115806"><span class="hs-identifier">initialCells</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Zhed.html#cellsFromList"><span class="hs-identifier hs-var">cellsFromList</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679115807"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679115807"><a href="#local-6989586621679115807"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679115800"><span class="hs-identifier hs-var">squares</span></a><span class="hs-special">]</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span>     </span><span class="hs-comment">-- Compute covered cells after applying the chosen moves</span><span>
</span><a name="line-193"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679115808"><a href="#local-6989586621679115808"><span class="hs-identifier">finalCells</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#applyMove"><span class="hs-identifier hs-var">applyMove</span></a><span> </span><a href="#local-6989586621679115799"><span class="hs-identifier hs-var">dim</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679115806"><span class="hs-identifier hs-var">initialCells</span></a><span> </span><a href="#local-6989586621679115805"><span class="hs-identifier hs-var">steps</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>     </span><span class="hs-comment">-- Check that at least one target is covered</span><span>
</span><a name="line-196"></a><span>     </span><a href="Ersatz.Prelude.html#assert"><span class="hs-identifier hs-var">assert</span></a><span> </span><span class="hs-special">(</span><a href="file:///Users/emertens/.cabal/store/ghc-8.6.1/rstz-0.4.4-b4c0a41d/share/doc/html/src/Ersatz.Bit.html#any"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679115808"><span class="hs-identifier hs-var">finalCells</span></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679115801"><span class="hs-identifier hs-var">targets</span></a><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span>     </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679115805"><span class="hs-identifier hs-var">steps</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-comment">-- | Run the SAT solver on the solution generated by 'solutionExists'</span><span>
</span><a name="line-202"></a><span class="hs-comment">--</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- &gt;&gt;&gt; findSolution smallZhed</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- Just [(C 1 2,2,R),(C 3 1,1,D)]</span><span>
</span><a name="line-205"></a><span class="hs-identifier">findSolution</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Zhed.html#Puzzle"><span class="hs-identifier hs-type">Puzzle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">,</span><span> </span><a href="Zhed.html#Dir"><span class="hs-identifier hs-type">Dir</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-206"></a><a name="findSolution"><a href="Zhed.html#findSolution"><span class="hs-identifier">findSolution</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ersatz.Prelude.html#solve"><span class="hs-identifier hs-var">solve</span></a><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Zhed.html#solutionExists"><span class="hs-identifier hs-var">solutionExists</span></a><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-comment">-- | Solve a given Zhed puzzle and print the solution to stdout.</span><span>
</span><a name="line-210"></a><span class="hs-comment">--</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- &gt;&gt;&gt; zhed smallZhed</span><span>
</span><a name="line-212"></a><span class="hs-comment">--  .  .  2v</span><span>
</span><a name="line-213"></a><span class="hs-comment">--  1&gt; .  .</span><span>
</span><a name="line-214"></a><span class="hs-comment">--  .  .  X</span><span>
</span><a name="line-215"></a><span class="hs-identifier">zhed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Zhed.html#Puzzle"><span class="hs-identifier hs-type">Puzzle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><a name="zhed"><a href="Zhed.html#zhed"><span class="hs-identifier">zhed</span></a></a><span> </span><a name="local-6989586621679115809"><a href="#local-6989586621679115809"><span class="hs-identifier">puzzle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-217"></a><span>  </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679115810"><a href="#local-6989586621679115810"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Zhed.html#findSolution"><span class="hs-identifier hs-var">findSolution</span></a><span> </span><a href="#local-6989586621679115809"><span class="hs-identifier hs-var">puzzle</span></a><span>
</span><a name="line-218"></a><span>     </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679115810"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-219"></a><span>       </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/System.IO.html#putStrLn"><span class="hs-identifier hs-var">putStrLn</span></a><span> </span><span class="hs-string">&quot;No solution&quot;</span><span>
</span><a name="line-220"></a><span>       </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-6989586621679115811"><a href="#local-6989586621679115811"><span class="hs-identifier">solution</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/System.IO.html#putStr"><span class="hs-identifier hs-var">putStr</span></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#renderSolution"><span class="hs-identifier hs-var">renderSolution</span></a><span> </span><a href="#local-6989586621679115809"><span class="hs-identifier hs-var">puzzle</span></a><span> </span><a href="#local-6989586621679115811"><span class="hs-identifier hs-var">solution</span></a><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span class="hs-comment">-- | Parse a puzzle representing square by their number value,</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- targets with an @X@ and empty space with @.@</span><span>
</span><a name="line-226"></a><span class="hs-comment">--</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- Example</span><span>
</span><a name="line-228"></a><span class="hs-comment">--</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- ..1</span><span>
</span><a name="line-231"></a><span class="hs-comment">-- 2..</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- ..X</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-234"></a><span class="hs-identifier">parsePuzzle</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Zhed.html#Puzzle"><span class="hs-identifier hs-type">Puzzle</span></a><span>
</span><a name="line-235"></a><a name="parsePuzzle"><a href="Zhed.html#parsePuzzle"><span class="hs-identifier">parsePuzzle</span></a></a><span> </span><a name="local-6989586621679115812"><a href="#local-6989586621679115812"><span class="hs-identifier">input</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Zhed.html#Puzzle"><span class="hs-identifier hs-var">Puzzle</span></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#Dim"><span class="hs-identifier hs-var">Dim</span></a><span> </span><a href="#local-6989586621679115814"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621679115815"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679115817"><span class="hs-identifier hs-var">numbers</span></a><span> </span><a href="#local-6989586621679115818"><span class="hs-identifier hs-var">targets</span></a><span>
</span><a name="line-236"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-237"></a><span>    </span><a name="local-6989586621679115813"><a href="#local-6989586621679115813"><span class="hs-identifier">rows</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.OldList.html#lines"><span class="hs-identifier hs-var">lines</span></a><span> </span><a href="#local-6989586621679115812"><span class="hs-identifier hs-var">input</span></a><span>
</span><a name="line-238"></a><span>    </span><a name="local-6989586621679115814"><a href="#local-6989586621679115814"><span class="hs-identifier">w</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Foldable.html#maximum"><span class="hs-identifier hs-var">maximum</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679115813"><span class="hs-identifier hs-var">rows</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>    </span><a name="local-6989586621679115815"><a href="#local-6989586621679115815"><span class="hs-identifier">h</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679115813"><span class="hs-identifier hs-var">rows</span></a><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span>    </span><a name="local-6989586621679115816"><a href="#local-6989586621679115816"><span class="hs-identifier">cells</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Zhed.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><a href="#local-6989586621679115821"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679115819"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115822"><span class="hs-identifier hs-var">elt</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679115819"><a href="#local-6989586621679115819"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><a name="local-6989586621679115820"><a href="#local-6989586621679115820"><span class="hs-identifier">row</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679115813"><span class="hs-identifier hs-var">rows</span></a><span>
</span><a name="line-242"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679115821"><a href="#local-6989586621679115821"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679115822"><a href="#local-6989586621679115822"><span class="hs-identifier">elt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679115820"><span class="hs-identifier hs-var">row</span></a><span class="hs-special">]</span><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span>    </span><a name="local-6989586621679115817"><a href="#local-6989586621679115817"><span class="hs-identifier">numbers</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679115823"><span class="hs-identifier hs-var">xy</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Char.html#digitToInt"><span class="hs-identifier hs-var">digitToInt</span></a><span> </span><a href="#local-6989586621679115824"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679115823"><a href="#local-6989586621679115823"><span class="hs-identifier">xy</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679115824"><a href="#local-6989586621679115824"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679115816"><span class="hs-identifier hs-var">cells</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Unicode.html#isDigit"><span class="hs-identifier hs-var">isDigit</span></a><span> </span><a href="#local-6989586621679115824"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-245"></a><span>    </span><a name="local-6989586621679115818"><a href="#local-6989586621679115818"><span class="hs-identifier">targets</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679115825"><span class="hs-identifier hs-var">xy</span></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679115825"><a href="#local-6989586621679115825"><span class="hs-identifier">xy</span></a></a><span class="hs-special">,</span><span class="hs-char">'X'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679115816"><span class="hs-identifier hs-var">cells</span></a><span class="hs-special">]</span><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span class="hs-comment">-- | Render a puzzle and its solution. Each square in the</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- puzzle will be changed to be its sequence number in</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- a satisfying solution and an indicator of the direction</span><span>
</span><a name="line-251"></a><span class="hs-comment">-- in which that square should be expanded.</span><span>
</span><a name="line-252"></a><span class="hs-identifier">renderSolution</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-253"></a><span>  </span><a href="Zhed.html#Puzzle"><span class="hs-identifier hs-type">Puzzle</span></a><span>              </span><span class="hs-comment">{- ^ puzzle            -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-254"></a><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Zhed.html#Coord"><span class="hs-identifier hs-type">Coord</span></a><span class="hs-special">,</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">,</span><span> </span><a href="Zhed.html#Dir"><span class="hs-identifier hs-type">Dir</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">{- ^ solution order    -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-255"></a><span>  </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>              </span><span class="hs-comment">{- ^ rendered solution -}</span><span>
</span><a name="line-256"></a><a name="renderSolution"><a href="Zhed.html#renderSolution"><span class="hs-identifier">renderSolution</span></a></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#Puzzle"><span class="hs-identifier hs-var">Puzzle</span></a><span> </span><span class="hs-special">(</span><a href="Zhed.html#Dim"><span class="hs-identifier hs-var">Dim</span></a><span> </span><a name="local-6989586621679115826"><a href="#local-6989586621679115826"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679115827"><a href="#local-6989586621679115827"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679115828"><a href="#local-6989586621679115828"><span class="hs-identifier">squares</span></a></a><span> </span><a name="local-6989586621679115829"><a href="#local-6989586621679115829"><span class="hs-identifier">targets</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679115830"><a href="#local-6989586621679115830"><span class="hs-identifier">steps</span></a></a><span>
</span><a name="line-257"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679115837"><span class="hs-identifier hs-var">mapToString</span></a><span>
</span><a name="line-258"></a><span>  </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679115831"><span class="hs-identifier hs-var">stage</span></a><span> </span><a href="#local-6989586621679115833"><span class="hs-identifier hs-var">addTarget</span></a><span> </span><a href="#local-6989586621679115829"><span class="hs-identifier hs-var">targets</span></a><span>
</span><a name="line-259"></a><span>  </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679115831"><span class="hs-identifier hs-var">stage</span></a><span> </span><a href="#local-6989586621679115835"><span class="hs-identifier hs-var">addStep</span></a><span>   </span><a href="#local-6989586621679115832"><span class="hs-identifier hs-var">steps'</span></a><span>
</span><a name="line-260"></a><span>  </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-6989586621679115831"><span class="hs-identifier hs-var">stage</span></a><span> </span><a href="#local-6989586621679115834"><span class="hs-identifier hs-var">addSquare</span></a><span> </span><a href="#local-6989586621679115828"><span class="hs-identifier hs-var">squares</span></a><span>
</span><a name="line-261"></a><span>  </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TotalMap.html#fromList"><span class="hs-identifier hs-var">TotalMap.fromList</span></a><span> </span><span class="hs-string">&quot; . &quot;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-264"></a><span>    </span><a name="local-6989586621679115831"><a href="#local-6989586621679115831"><span class="hs-identifier">stage</span></a></a><span> </span><a name="local-6989586621679115838"><a href="#local-6989586621679115838"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679115839"><a href="#local-6989586621679115839"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679115840"><a href="#local-6989586621679115840"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="#local-6989586621679115838"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679115840"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679115839"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span>    </span><span class="hs-comment">-- replace square number with sequence number</span><span>
</span><a name="line-267"></a><span>    </span><a name="local-6989586621679115832"><a href="#local-6989586621679115832"><span class="hs-identifier">steps'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679115842"><span class="hs-identifier hs-var">xy</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115841"><span class="hs-identifier hs-var">i</span></a><span class="hs-glyph">::</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679115843"><span class="hs-identifier hs-var">dir</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679115841"><a href="#local-6989586621679115841"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679115842"><a href="#local-6989586621679115842"><span class="hs-identifier">xy</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679115843"><a href="#local-6989586621679115843"><span class="hs-identifier">dir</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679115830"><span class="hs-identifier hs-var">steps</span></a><span class="hs-special">]</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span>    </span><a name="local-6989586621679115833"><a href="#local-6989586621679115833"><span class="hs-identifier">addTarget</span></a></a><span> </span><a name="local-6989586621679115844"><a href="#local-6989586621679115844"><span class="hs-identifier">xy</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679115844"><span class="hs-identifier hs-var">xy</span></a><span> </span><a href="TotalMap.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a><span> </span><span class="hs-string">&quot; X &quot;</span><span>
</span><a name="line-270"></a><span>    </span><a name="local-6989586621679115834"><a href="#local-6989586621679115834"><span class="hs-identifier">addSquare</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679115845"><a href="#local-6989586621679115845"><span class="hs-identifier">xy</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679115845"><span class="hs-identifier hs-var">xy</span></a><span> </span><a href="TotalMap.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a><span> </span><span class="hs-string">&quot; # &quot;</span><span>
</span><a name="line-271"></a><span>    </span><a name="local-6989586621679115835"><a href="#local-6989586621679115835"><span class="hs-identifier">addStep</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679115846"><a href="#local-6989586621679115846"><span class="hs-identifier">xy</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679115847"><a href="#local-6989586621679115847"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679115848"><a href="#local-6989586621679115848"><span class="hs-identifier">dir</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679115846"><span class="hs-identifier hs-var">xy</span></a><span> </span><a href="TotalMap.html#%3D%3A"><span class="hs-operator hs-var">=:</span></a><span> </span><a href="#local-6989586621679115849"><span class="hs-identifier hs-var">pads</span></a><span> </span><span class="hs-special">(</span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Show.html#shows"><span class="hs-identifier hs-var">shows</span></a><span> </span><a href="#local-6989586621679115847"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679115836"><span class="hs-identifier hs-var">showDir</span></a><span> </span><a href="#local-6989586621679115848"><span class="hs-identifier hs-var">dir</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-273"></a><span>        </span><a name="local-6989586621679115849"><a href="#local-6989586621679115849"><span class="hs-identifier">pads</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679115847"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/ghc-prim-0.5.3/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a><span> </span><span class="hs-number">10</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-char">' '</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span>    </span><a name="local-6989586621679115836"><a href="#local-6989586621679115836"><span class="hs-identifier">showDir</span></a></a><span> </span><a name="local-6989586621679115850"><a href="#local-6989586621679115850"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679115850"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-keyword">of</span><span> </span><a href="Zhed.html#U"><span class="hs-identifier hs-var">U</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;^&quot;</span><span class="hs-special">;</span><span> </span><a href="Zhed.html#D"><span class="hs-identifier hs-var">D</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;v&quot;</span><span class="hs-special">;</span><span> </span><a href="Zhed.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;&lt;&quot;</span><span class="hs-special">;</span><span> </span><a href="Zhed.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;&gt;&quot;</span><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span>    </span><a name="local-6989586621679115837"><a href="#local-6989586621679115837"><span class="hs-identifier">mapToString</span></a></a><span> </span><a name="local-6989586621679115851"><a href="#local-6989586621679115851"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-278"></a><span>      </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.OldList.html#unlines"><span class="hs-identifier hs-var">unlines</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="file:///Users/emertens/Tools/ghc-8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679115851"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="Zhed.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><a href="#local-6989586621679115853"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679115852"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679115853"><a href="#local-6989586621679115853"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679115826"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-279"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679115852"><a href="#local-6989586621679115852"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679115827"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-280"></a></pre></body></html>